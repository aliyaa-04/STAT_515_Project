left_join(smq, by="SEQN")
nhanes_adults <- nhanes_all %>%
filter(RIDAGEYR >= 20 | is.na(RIDAGEYR))
write.csv(nhanes_adults,
"nhanes_2021_2023_chronic_disease.csv",
row.names = FALSE)
data <- read.csv("nhanes_2021_2023_chronic_disease.csv")
str(data)
library(ggplot2)
install.packages("corrplot")
library(corrplot)
cat("Original rows:", nrow(data), "\n")
cat("Original columns:", ncol(data), "\n")
nhanes_clean <- data %>%
distinct()
cat("Rows after removing duplicates:", nrow(nhanes_clean), "\n")
special_na_codes <- c(
7, 8, 9,
77, 88, 99,
777, 888, 999,
7777, 8888, 9999
)
nhanes_clean <- nhanes_clean %>%
mutate(
across(
.cols = where(is.numeric),
.fns  = ~ ifelse(.x %in% special_na_codes, NA_real_, .x)
)
)
missing_strings <- c(
"Refused",
"Don't know",
"Missing",
"Blank but applicable",
"NA",       # sometimes imported as text
""          # empty string
)
nhanes_clean <- nhanes_clean %>%
mutate(
across(
.cols = where(is.character),
.fns  = ~ ifelse(.x %in% missing_strings, NA_character_, .x)
)
)
summary_vars <- data %>%
select(
RIDAGEYR,      # Age
BMXBMI,        # BMI
BMXWT,         # Weight
BMXHT,         # Height
BMXWAIST,      # Waist
SBP_mean,      # Systolic BP
DBP_mean,      # Diastolic BP
LBXGH,         # A1C
LBXTC          # Total Cholesterol
)
missing_strings <- c(
"Refused",
"Don't know",
"Missing",
"Blank but applicable",
"NA",
""
)
nhanes <- nhanes %>%
mutate(
across(
.cols = where(is.numeric),
.fns  = ~ ifelse(.x %in% special_na_codes, NA_real_, .x)
),
across(
.cols = where(is.character),
.fns  = ~ ifelse(.x %in% missing_strings, NA_character_, .x)
)
)
nhanes <- nhanes_clean %>%
mutate(
across(
.cols = where(is.numeric),
.fns  = ~ ifelse(.x %in% special_na_codes, NA_real_, .x)
),
across(
.cols = where(is.character),
.fns  = ~ ifelse(.x %in% missing_strings, NA_character_, .x)
)
)
# Blood pressure means from 3 measurements (oscillometric)
nhanes <- nhanes %>%
mutate(
SBP_mean = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),
DBP_mean = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)
)
# Binary diabetes indicator (DIQ010: 1 = Yes, 2 = No)
nhanes <- nhanes %>%
mutate(
diabetes = case_when(
DIQ010 == 1 ~ 1,
DIQ010 == 2 ~ 0,
TRUE        ~ NA_real_
)
)
# Smoking status: ever smoked 100 cigarettes (SMQ020: 1 = Yes, 2 = No)
nhanes <- nhanes %>%
mutate(
smoker_ever = case_when(
SMQ020 == 1 ~ 1,
SMQ020 == 2 ~ 0,
TRUE        ~ NA_real_
)
)
# Optional: save cleaned CSV (for backup/reuse)
write.csv(nhanes, "nhanes_2021_2023_chronic_disease_clean.csv", row.names = FALSE)
summary_vars <- nhanes %>%
select(
RIDAGEYR,      # Age
BMXBMI,        # BMI
BMXWT,         # Weight
BMXHT,         # Height
BMXWAIST,      # Waist circumference
SBP_mean,      # Systolic BP
DBP_mean,      # Diastolic BP
LBXGH,         # HbA1c
LBXTC          # Total Cholesterol
)
summary(summary_vars)
ggplot(data, aes(x = RIDAGEYR)) +
geom_histogram(bins = 30, fill = "steelblue", color = "black") +
labs(title = "Distribution of Age (Adults Only)",
x = "Age (years)", y = "Count")
ggplot(data, aes(x = BMXBMI)) +
geom_histogram(bins = 30, fill = "darkorange", color = "black") +
labs(title = "Distribution of BMI",
x = "BMI", y = "Count")
sum(is.na(data$BMXBMI))
ggplot(data, aes(x = factor(RIAGENDR), y = BMXBMI, fill = factor(RIAGENDR))) +
geom_boxplot() +
labs(title = "BMI by Gender",
x = "Gender (1 = Male, 2 = Female)",
y = "BMI")
ggplot(data, aes(x = SBP_mean)) +
geom_histogram(bins = 30, fill = "firebrick", color = "black") +
labs(title = "Distribution of Systolic Blood Pressure",
x = "Mean Systolic BP (mmHg)", y = "Count")
ggplot(data, aes(x = DBP_mean)) +
geom_histogram(bins = 30, fill = "tan", color = "black") +
labs(title = "Distribution of Diastolic Blood Pressure",
x = "Mean Diastolic BP (mmHg)", y = "Count")
ggplot(data, aes(x = SBP_mean)) +
geom_histogram(bins = 30, fill = "firebrick", color = "black") +
labs(title = "Distribution of Systolic Blood Pressure",
x = "Mean Systolic BP (mmHg)", y = "Count")
ggplot(nhanes, aes(x = SBP_mean)) +
geom_histogram(bins = 30, fill = "firebrick", color = "black") +
labs(title = "Distribution of Systolic Blood Pressure",
x = "Mean SBP (mmHg)", y = "Count")
ggplot(nhanes, aes(x = DBP_mean)) +
geom_histogram(bins = 30, fill = "tan", color = "black") +
labs(title = "Distribution of Diastolic Blood Pressure",
x = "Mean Diastolic BP (mmHg)", y = "Count")
ggplot(nhanes, aes(x = LBXTC)) +
geom_histogram(bins = 25, fill = "forestgreen", color = "black") +
labs(title = "Distribution of Total Cholesterol",
x = "Cholesterol (mg/dL)", y = "Count")
num_vars <- nhanes %>%
select(RIDAGEYR, BMXBMI, BMXWAIST, SBP_mean, DBP_mean, LBXGH, LBXTC)
corr_matrix <- cor(num_vars, use = "pairwise.complete.obs")
corrplot(corr_matrix, method = "color", type = "upper",
tl.col = "black", tl.cex = 0.9)
nhanes_analysis <- nhanes %>%
select(
SEQN,
RIDAGEYR, RIAGENDR, RIDRETH3,
INDFMPIR, DMDEDUC2,
BMXBMI, BMXWT, BMXHT, BMXWAIST,
SBP_mean, DBP_mean,
LBXGH,      # HbA1c
LBXTC,      # total cholesterol
diabetes,
smoker_ever
) %>%
nhanes_analysis <- nhanes %>%
select(
SEQN,
RIDAGEYR, RIAGENDR, RIDRETH3,
INDFMPIR, DMDEDUC2,
BMXBMI, BMXWT, BMXHT, BMXWAIST,
SBP_mean, DBP_mean,
LBXGH,      # HbA1c
LBXTC,      # total cholesterol
diabetes,
smoker_ever
) %>%
# Require key health measures to be present
drop_na(RIDAGEYR, BMXBMI, LBXGH, LBXTC, SBP_mean, DBP_mean)
nhanes_analysis <- nhanes %>%
select(
SEQN,
RIDAGEYR, RIAGENDR, RIDRETH3,
INDFMPIR, DMDEDUC2,
BMXBMI, BMXWT, BMXHT, BMXWAIST,
SBP_mean, DBP_mean,
LBXGH,      # HbA1c
LBXTC,      # total cholesterol
diabetes,
smoker_ever
) %>%
# Require key health measures to be present
drop_na(RIDAGEYR, BMXBMI, LBXGH, LBXTC, SBP_mean, DBP_mean)
log_data <- nhanes_analysis %>%
drop_na(
diabetes,
RIDAGEYR, BMXBMI,
SBP_mean, DBP_mean,
LBXGH, LBXTC,
smoker_ever,
INDFMPIR, DMDEDUC2
)
View(bmx)
install.packages("haven")
install.packages("dplyr")
library(haven) # need to change from .xpt file to csv
library(dplyr)
base <- "https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/"
read_nhanes <- function(stub) {
url_full <- paste0(base, stub, ".xpt")  # note: .xpt is lowercase
message("Downloading: ", url_full)
read_xpt(url_full)
}
# Read files
demo  <- read_nhanes("DEMO_L") #demographics
bmx   <- read_nhanes("BMX_L") #body measures
bpxo  <- read_nhanes("BPXO_L") #blood pressure
ghb   <- read_nhanes("GHB_L") #hbA1c
tchol <- read_nhanes("TCHOL_L") #total cholesterol
diq   <- read_nhanes("DIQ_L") #diabetes questionnaire
smq   <- read_nhanes("SMQ_L") #smoking questionnaire
nhanes_all <- demo %>%
left_join(bmx, by="SEQN") %>%
left_join(bpxo, by="SEQN") %>%
left_join(ghb, by="SEQN") %>%
left_join(tchol, by="SEQN") %>%
left_join(diq, by="SEQN") %>%
left_join(smq, by="SEQN")
nhanes_adults <- nhanes_all %>%
filter(RIDAGEYR >= 20 | is.na(RIDAGEYR))
write.csv(nhanes_adults,
"nhanes_2021_2023_chronic_disease.csv",
row.names = FALSE)
data <- read.csv("nhanes_2021_2023_chronic_disease.csv")
str(data)
library(ggplot2)
install.packages("corrplot")
library(corrplot)
cat("Original rows:", nrow(data), "\n")
cat("Original columns:", ncol(data), "\n")
data_rows("Original rows:", nrow(data), "\n")
cat("Original rows:", nrow(data), "\n")
cat("Original columns:", ncol(data), "\n")
nhanes_clean <- data %>%
distinct()
cat("Rows after removing duplicate:", nrow(nhanes_clean), "\n")
special_codes <- c(
7, 8, 9,
77, 88, 99,
777, 888, 999,
7777, 8888, 9999
)
missing_codes <- c(
"Refused",
"Don't know",
"Missing",
"Blank but applicable",
"NA",
""
)
nhanes <- nhanes_clean %>%
mutate(
across(
.cols = where(is.numeric),
.fns  = ~ ifelse(.x %in% special_codes, NA_real_, .x)
),
across(
.cols = where(is.character),
.fns  = ~ ifelse(.x %in% missing_codes, NA_character_, .x)
)
)
nhanes <- nhanes %>%
mutate(
SBP_mean = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),
DBP_mean = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)
)
nhanes <- nhanes %>%
mutate(
diabetes = case_when(
DIQ010 == 1 ~ 1,
DIQ010 == 2 ~ 0,
TRUE        ~ NA_real_
)
)
nhanes <- nhanes %>%
mutate(
diabetes = case_when(
DIQ010 == 1 ~ 1,
DIQ010 == 2 ~ 0,
TRUE        ~ NA_real_
)
)
nhanes <- nhanes %>%
mutate(
smoker_ever = case_when(
SMQ020 == 1 ~ 1,
SMQ020 == 2 ~ 0,
TRUE        ~ NA_real_
)
)
write.csv(nhanes, "nhanes_2021_2023_chronic_disease_clean.csv", row.names = FALSE)
summary_vars <- nhanes %>%
select(
RIDAGEYR,      # Age
BMXBMI,        # BMI
BMXWT,         # Weight
BMXHT,         # Height
BMXWAIST,      # Waist circumference
SBP_mean,      # Systolic BP
DBP_mean,      # Diastolic BP
LBXGH,         # HbA1c
LBXTC          # Total Cholesterol
)
summary(summary_vars)
ggplot(nhanes, aes(x = RIDAGEYR)) +
geom_histogram(bins = 30, fill = "steelblue", color = "black") +
labs(
title = "Distribution of Age (Adults Only)",
x = "Age (years)",
y = "Count"
) + theme_minimal()
ggplot(nhanes, aes(x = BMXBMI)) +
geom_histogram(bins = 30, fill = "darkred", color = "black") +
labs(title = "Distribution of BMI",
x = "BMI", y = "Count") + theme_minimal()
nhanes <- nhanes %>%
mutate(
gender = factor(RIAGENDR,
levels = c(1, 2),
labels = c("Male", "Female"))
)
ggplot(nhanes, aes(x = gender, y = BMXBMI, fill = gender)) +
geom_boxplot() +
labs(title = "BMI by Gender",
x = "Gender",
y = "BMI (kg/m²)") +
theme_minimal()
ggplot(nhanes, aes(x = gender, y = BMXBMI, fill = gender)) +
geom_boxplot() +
labs(title = "BMI by Gender",
x = "Gender",
y = "BMI (kg/m²)") +
theme_minimal() +
theme(legend.position = "none")
ggplot(nhanes, aes(x = gender, y = BMXBMI, fill = gender)) +
geom_boxplot() +
labs(title = "BMI by Gender",
x = "Gender",
y = "BMI") + theme_minimal()
ggplot(nhanes, aes(x = SBP_mean)) +
geom_histogram(bins = 30, fill = "lightyellow", color = "black") +
labs(title = "Distribution of Mean Systolic Blood Pressure",
x = "Mean SBP (mmHg)", y = "Count") + theme_minimal()
ggplot(nhanes, aes(x = DBP_mean)) +
geom_histogram(bins = 30, fill = "yellow", color = "black") +
labs(title = "Distribution of Mean Diastolic Blood Pressure",
x = "Mean DBP (mmHg)", y = "Count") + theme_minimal()
ggplot(nhanes, aes(x = LBXTC)) +
geom_histogram(bins = 30, fill = "pink", color = "black") +
labs(title = "Distribution of Total Cholesterol",
x = "Total Cholesterol", y = "Count") + theme_minimal()
ggplot(nhanes, aes(x = LBXGH)) +
geom_histogram(bins = 30, fill = "skyblue", color = "black") +
labs(title = "Distribution of HbA1c",
x = "HbA1c (%)", y = "Count") + theme_minimal()
num_vars <- nhanes %>%
select(
RIDAGEYR,   # Age
BMXBMI,     # BMI
BMXWAIST,   # Waist circumference
SBP_mean,   # Systolic BP
DBP_mean,   # Diastolic BP
LBXGH,      # HbA1c
LBXTC       # Total cholesterol
)
# Correlation matrix (pairwise complete obs ignores NAs)
corr_matrix <- cor(num_vars, use = "pairwise.complete.obs")
corrplot(corr_matrix,
method = "color",
type   = "upper",
tl.col = "black",
tl.cex = 0.9,
title  = "Correlation Between Key Health Variables",
mar    = c(0,0,2,0))
nhanes_rq1 <- nhanes %>%
mutate(
diabetes = ifelse(DIQ010 == 1, 1, 0)
) %>%
drop_na(BMXBMI, diabetes)
#Answering Research Questions
#RQ1
library(tidyr)
nhanes_rq1 <- nhanes %>%
mutate(
diabetes = ifelse(DIQ010 == 1, 1, 0)
) %>%
drop_na(BMXBMI, diabetes)
# Logistic regression model
model_rq1 <- glm(diabetes ~ BMXBMI, data = nhanes_rq1, family = "binomial")
summary(model_rq1)
prev_bmi <- nhanes_rq1 %>%
mutate(bmi_group = cut(
BMXBMI,
breaks = c(-Inf, 18.5, 25, 30, 35, Inf),
labels = c("Underweight", "Normal", "Overweight", "Obese", "Severe Obese")
)) %>%
group_by(bmi_group) %>%
summarize(
total = n(),
diabetes_cases = sum(diabetes == 1),
prevalence = diabetes_cases / total
)
ggplot(prev_bmi, aes(x = bmi_group, y = prevalence)) +
geom_col(fill = "steelblue") +
geom_text(aes(label = round(prevalence, 3)), vjust = -0.4) +
labs(title = "Diabetes Prevalence by BMI Category",
x = "BMI Category",
y = "Prevalence of Diabetes") + theme_minimal()
log_r2 <- nhanes_analysis %>%
drop_na(
diabetes,
BMXBMI, SBP_mean, DBP_mean,
LBXGH, LBXTC, smoker_ever
)
nhanes_rq2 <- nhanes %>%
select(
SEQN,
RIDAGEYR,        # Age
RIAGENDR,        # Gender
RIDRETH3,        # Race/Ethnicity
INDFMPIR,        # Income ratio
DMDEDUC2,        # Education
BMXBMI,          # BMI
BMXWT,           # Weight
BMXHT,           # Height
BMXWAIST,        # Waist circumference
SBP_mean,        # Systolic BP
DBP_mean,        # Diastolic BP
LBXGH,           # HbA1c
LBXTC,           # Total cholesterol
diabetes,        # Diabetes (0/1)
smoker_ever      # Smoking (0/1)
) %>%
drop_na(RIDAGEYR, BMXBMI, LBXGH, LBXTC, SBP_mean, DBP_mean)
log_r2 <- nhanes_rq2 %>%
drop_na(
diabetes,
BMXBMI, SBP_mean, DBP_mean,
LBXGH, LBXTC, smoker_ever
)
model_rq2 <- glm(
diabetes ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,
data = log_r2,
family = "binomial"
)
summary(model_rq2)
pred_prob <- predict(model_rq2, type = "response")
pred_class <- ifelse(pred_prob > 0.5, 1, 0)
table(Predicted = pred_class, Actual = log_r2$diabetes)
library(tree)
tree_rq2 <- tree(factor(diabetes) ~ BMXBMI + SBP_mean + DBP_mean +
LBXGH + LBXTC + smoker_ever,
data = log_r2)
plot(tree_rq2)
text(tree_rq2, pretty = 0)
#RESEARCH QUESTION 3
nhanes_rq3 <- nhanes %>%
mutate(
high_risk = ifelse(
LBXGH >= 5.7 | BMXBMI >= 30 | SBP_mean >= 130 | LBXTC >= 200,
1, 0
)
) %>%
select(BMXBMI, SBP_mean, DBP_mean, LBXGH, LBXTC, smoker_ever, high_risk) %>%
drop_na()
model_rq3 <- glm(
high_risk ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,
data = rq3,
family = "binomial"
)
model_rq3 <- glm(
high_risk ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,
data = nhanes_rq3,
family = "binomial"
)
summary(model_rq3)
prob3 <- predict(model_rq3, type = "response")
pred3 <- ifelse(prob3 > 0.5, 1, 0)
table(Predicted = pred3, Actual = nhanes_rq3$high_risk)
library(randomForest)
rf_rq3 <- randomForest(
factor(high_risk) ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,
data = nhanes_rq3,
ntree = 200,
mtry = 3
)
rf_rq3
