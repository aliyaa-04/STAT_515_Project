{
  "hash": "0c485e8b958ad4476cf93abbddd66323",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Codes\"\nformat: html\n---\n\n### Source Codes\n\nIn this page, We will present and explain the codes we used to explore and analyse our project.\n\n#### Initializing and setting up \n\n1\\) We install two packages, \"haven\" and \"dplyr\".\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"haven\")\n#install.packages(\"dplyr\")\n\nlibrary(haven) # need to change from .xpt file to csv\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'haven' was built under R version 4.5.2\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'dplyr' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n:::\n\n\n2\\) Next, we set the base URL\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbase <- \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/\"\n```\n:::\n\n\n3\\) Insert our file\n\n\n::: {.cell}\n\n```{.r .cell-code}\nread_nhanes <- function(stub) {\n  url_full <- paste0(base, stub, \".xpt\")  # note: .xpt is lowercase\n  message(\"Downloading: \", url_full)\n  read_xpt(url_full)\n}\n```\n:::\n\n\n4\\) Read the files from the dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndemo  <- read_nhanes(\"DEMO_L\") #demographics\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading: https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/DEMO_L.xpt\n```\n\n\n:::\n\n```{.r .cell-code}\nbmx   <- read_nhanes(\"BMX_L\") #body measures\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading: https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BMX_L.xpt\n```\n\n\n:::\n\n```{.r .cell-code}\nbpxo  <- read_nhanes(\"BPXO_L\") #blood pressure\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading: https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/BPXO_L.xpt\n```\n\n\n:::\n\n```{.r .cell-code}\nghb   <- read_nhanes(\"GHB_L\") #hbA1c\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading: https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/GHB_L.xpt\n```\n\n\n:::\n\n```{.r .cell-code}\ntchol <- read_nhanes(\"TCHOL_L\") #total cholesterol\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading: https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/TCHOL_L.xpt\n```\n\n\n:::\n\n```{.r .cell-code}\ndiq   <- read_nhanes(\"DIQ_L\") #diabetes questionnaire \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading: https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/DIQ_L.xpt\n```\n\n\n:::\n\n```{.r .cell-code}\nsmq   <- read_nhanes(\"SMQ_L\") #smoking questionnaire \n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nDownloading: https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/SMQ_L.xpt\n```\n\n\n:::\n:::\n\n\n5\\) Merge the needed variables across the datasets usings a common identifier \"SEQN\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes_all <- demo %>%\n  left_join(bmx, by=\"SEQN\") %>%\n  left_join(bpxo, by=\"SEQN\") %>%\n  left_join(ghb, by=\"SEQN\") %>%\n  left_join(tchol, by=\"SEQN\") %>%\n  left_join(diq, by=\"SEQN\") %>%\n  left_join(smq, by=\"SEQN\")\n```\n:::\n\n\n6\\) Keep the data of adults\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes_adults <- nhanes_all %>%\n  filter(RIDAGEYR >= 20 | is.na(RIDAGEYR))\n```\n:::\n\n\n7\\) Save the new CSV file\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv(nhanes_adults,\n          \"nhanes_2021_2023_chronic_disease.csv\",\n          row.names = FALSE)\n```\n:::\n\n\n#### Set up the new data for exploration and analysis\n\n1\\) New dataset with important variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- read.csv(\"nhanes_2021_2023_chronic_disease.csv\")\nstr(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t7809 obs. of  80 variables:\n $ SEQN     : int  130378 130379 130380 130384 130385 130386 130387 130388 130389 130390 ...\n $ SDDSRVYR : int  12 12 12 12 12 12 12 12 12 12 ...\n $ RIDSTATR : int  2 2 2 1 1 2 2 2 2 2 ...\n $ RIAGENDR : int  1 1 2 1 2 1 2 2 1 2 ...\n $ RIDAGEYR : int  43 66 44 43 65 34 68 27 59 31 ...\n $ RIDAGEMN : logi  NA NA NA NA NA NA ...\n $ RIDRETH1 : int  5 3 2 1 3 1 3 4 3 3 ...\n $ RIDRETH3 : int  6 3 2 1 3 1 3 4 3 3 ...\n $ RIDEXMON : int  2 2 1 NA NA 1 2 1 1 2 ...\n $ RIDEXAGM : logi  NA NA NA NA NA NA ...\n $ DMQMILIZ : int  2 2 2 2 2 2 2 2 2 1 ...\n $ DMDBORN4 : int  2 1 2 2 1 1 1 1 2 1 ...\n $ DMDYRUSR : int  6 NA 6 5 NA NA NA NA 6 NA ...\n $ DMDEDUC2 : int  5 5 3 2 3 4 5 4 5 3 ...\n $ DMDMARTZ : int  1 1 1 3 1 1 3 1 1 1 ...\n $ RIDEXPRG : int  NA NA 2 NA NA NA NA 2 NA 2 ...\n $ DMDHHSIZ : int  4 2 7 2 2 3 1 5 2 5 ...\n $ DMDHRGND : logi  NA NA NA NA NA NA ...\n $ DMDHRAGZ : logi  NA NA NA NA NA NA ...\n $ DMDHREDZ : logi  NA NA NA NA NA NA ...\n $ DMDHRMAZ : logi  NA NA NA NA NA NA ...\n $ DMDHSEDZ : logi  NA NA NA NA NA NA ...\n $ WTINT2YR : num  50055 29087 80063 15079 16151 ...\n $ WTMEC2YR : num  54374 34085 81196 0 0 ...\n $ SDMVSTRA : int  173 173 174 179 187 179 181 187 174 185 ...\n $ SDMVPSU  : int  2 2 1 2 2 1 1 1 2 2 ...\n $ INDFMPIR : num  5 5 1.41 0.63 5 1.33 1.32 0.81 5 2.16 ...\n $ BMDSTATS : int  1 1 1 NA NA 1 1 1 1 1 ...\n $ BMXWT    : num  86.9 101.8 69.4 NA NA ...\n $ BMIWT    : int  NA NA NA NA NA NA NA NA NA NA ...\n $ BMXRECUM : logi  NA NA NA NA NA NA ...\n $ BMIRECUM : logi  NA NA NA NA NA NA ...\n $ BMXHEAD  : logi  NA NA NA NA NA NA ...\n $ BMIHEAD  : logi  NA NA NA NA NA NA ...\n $ BMXHT    : num  180 174 153 NA NA ...\n $ BMIHT    : int  NA NA NA NA NA NA NA NA NA NA ...\n $ BMXBMI   : num  27 33.5 29.7 NA NA 30.2 42.6 43.7 28 46 ...\n $ BMDBMIC  : logi  NA NA NA NA NA NA ...\n $ BMXLEG   : num  42.8 38.5 38.5 NA NA 42.8 36.1 40 36.2 34 ...\n $ BMILEG   : int  NA NA NA NA NA NA NA NA NA NA ...\n $ BMXARML  : num  42 38.7 35.5 NA NA 36.2 37.7 39.5 39.2 40.4 ...\n $ BMIARML  : int  NA NA NA NA NA NA NA NA NA NA ...\n $ BMXARMC  : num  35.7 33.7 36.3 NA NA 35.7 37.4 45.7 31.9 46 ...\n $ BMIARMC  : int  NA NA NA NA NA NA NA NA NA NA ...\n $ BMXWAIST : num  98.3 114.7 93.5 NA NA ...\n $ BMIWAIST : int  NA NA NA NA NA NA NA NA NA NA ...\n $ BMXHIP   : num  103 112 98 NA NA ...\n $ BMIHIP   : int  NA NA NA NA NA NA NA NA NA NA ...\n $ BPAOARM  : chr  \"R\" \"R\" \"R\" NA ...\n $ BPAOCSZ  : int  4 4 4 NA NA 4 4 5 3 5 ...\n $ BPXOSY1  : int  135 121 111 NA NA 110 143 130 145 113 ...\n $ BPXODI1  : int  98 84 79 NA NA 72 76 95 76 78 ...\n $ BPXOSY2  : int  131 117 112 NA NA 120 136 128 130 106 ...\n $ BPXODI2  : int  96 76 80 NA NA 74 74 100 81 78 ...\n $ BPXOSY3  : int  132 113 104 NA NA 115 145 129 124 115 ...\n $ BPXODI3  : int  94 76 76 NA NA 75 78 104 81 68 ...\n $ BPXOPLS1 : int  82 72 84 NA NA 59 80 76 58 95 ...\n $ BPXOPLS2 : int  79 71 83 NA NA 64 80 84 54 95 ...\n $ BPXOPLS3 : int  82 73 77 NA NA 64 77 86 62 93 ...\n $ WTPH2YR.x: num  56042 37436 85329 NA NA ...\n $ LBXGH    : num  5.6 5.6 6.2 NA NA 5.1 5.9 4.9 5.5 5.9 ...\n $ WTPH2YR.y: num  56042 37436 85329 NA NA ...\n $ LBXTC    : int  264 214 187 NA NA 183 203 NA NA 159 ...\n $ LBDTCSI  : num  6.83 5.53 4.84 NA NA 4.73 5.25 NA NA 4.11 ...\n $ DIQ010   : int  2 2 1 2 2 2 2 2 2 2 ...\n $ DID040   : int  NA NA 35 NA NA NA NA NA NA NA ...\n $ DIQ160   : int  2 2 NA 2 1 2 2 2 1 2 ...\n $ DIQ180   : int  2 1 NA 2 1 2 2 2 1 2 ...\n $ DIQ050   : int  NA NA 2 NA NA NA NA NA NA NA ...\n $ DID060   : int  NA NA NA NA NA NA NA NA NA NA ...\n $ DIQ060U  : int  NA NA NA NA NA NA NA NA NA NA ...\n $ DIQ070   : int  NA NA 1 NA 2 NA NA NA 2 NA ...\n $ SMQ020   : int  1 1 2 2 2 1 2 1 1 2 ...\n $ SMQ040   : int  3 3 NA NA NA 3 NA 1 3 NA ...\n $ SMD641   : int  NA NA NA NA NA NA NA NA NA NA ...\n $ SMD650   : int  NA NA NA NA NA NA NA 6 NA NA ...\n $ SMD100MN : int  NA NA NA NA NA NA NA 1 NA NA ...\n $ SMQ621   : logi  NA NA NA NA NA NA ...\n $ SMD630   : logi  NA NA NA NA NA NA ...\n $ SMAQUEX2 : int  1 1 1 1 1 1 1 1 1 1 ...\n```\n\n\n:::\n:::\n\n\n2\\) Install additional libraries for visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n#install.packages(\"corrplot\")\nlibrary(corrplot)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'corrplot' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\ncorrplot 0.95 loaded\n```\n\n\n:::\n:::\n\n\n3\\) Ensure no duplicate rows exist in the dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(\"Original rows:\", nrow(data), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOriginal rows: 7809 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Original columns:\", ncol(data), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOriginal columns: 80 \n```\n\n\n:::\n\n```{.r .cell-code}\nnhanes_clean <- data %>%\n  distinct()\n\ncat(\"Rows after removing duplicate:\", nrow(nhanes_clean), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows after removing duplicate: 7809 \n```\n\n\n:::\n\n```{.r .cell-code}\n#no duplicate rows\n```\n:::\n\n\n4\\) Conversion of NHANES codes to numeric\n\n\n::: {.cell}\n\n```{.r .cell-code}\nspecial_codes <- c(\n  7, 8, 9,\n  77, 88, 99,\n  777, 888, 999,\n  7777, 8888, 9999\n)\nmissing_codes <- c(\n  \"Refused\",\n  \"Don't know\",\n  \"Missing\",\n  \"Blank but applicable\",\n  \"NA\",\n  \"\"\n)\nnhanes <- nhanes_clean %>%\n  mutate(\n    across(\n      .cols = where(is.numeric),\n      .fns  = ~ ifelse(.x %in% special_codes, NA_real_, .x)\n    ),\n    across(\n      .cols = where(is.character),\n      .fns  = ~ ifelse(.x %in% missing_codes, NA_character_, .x)\n    )\n  )\n```\n:::\n\n\n#### Setting up important health variables\n\n1\\) Setting up Blood pressure means\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes <- nhanes %>%\n  mutate(\n    SBP_mean = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),\n    DBP_mean = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)\n  )\n```\n:::\n\n\n2\\) Diabetes indicators using binary (1 = Yes, 2 = No)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes <- nhanes %>%\n  mutate(\n    diabetes = case_when(\n      DIQ010 == 1 ~ 1,\n      DIQ010 == 2 ~ 0,\n      TRUE        ~ NA_real_\n    )\n  )\n```\n:::\n\n\n3\\) Smoking status (ever smoked 100 cigarettes, 1 = YES, 2 = NO)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes <- nhanes %>%\n  mutate(\n    smoker_ever = case_when(\n      SMQ020 == 1 ~ 1,\n      SMQ020 == 2 ~ 0,\n      TRUE        ~ NA_real_\n    )\n  )\n```\n:::\n\n\n4\\) Saving the file again (Just in case)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv(nhanes, \"nhanes_2021_2023_chronic_disease_clean.csv\", row.names = FALSE)\n```\n:::\n\n\n#### Exploratory Analysis\n\n1\\) Numerical summary of the dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary_vars <- nhanes %>%\n  select(\n    RIDAGEYR,      # Age\n    BMXBMI,        # BMI\n    BMXWT,         # Weight\n    BMXHT,         # Height\n    BMXWAIST,      # Waist circumference\n    SBP_mean,      # Systolic BP\n    DBP_mean,      # Diastolic BP\n    LBXGH,         # HbA1c\n    LBXTC          # Total Cholesterol\n  )\n\nsummary(summary_vars)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    RIDAGEYR         BMXBMI          BMXWT            BMXHT      \n Min.   :20.00   Min.   :11.10   Min.   : 27.90   Min.   :133.0  \n 1st Qu.:38.00   1st Qu.:24.70   1st Qu.: 67.50   1st Qu.:159.6  \n Median :56.00   Median :28.50   Median : 79.80   Median :166.5  \n Mean   :53.37   Mean   :29.83   Mean   : 83.28   Mean   :166.9  \n 3rd Qu.:68.00   3rd Qu.:33.60   3rd Qu.: 95.40   3rd Qu.:174.2  \n Max.   :80.00   Max.   :74.80   Max.   :248.20   Max.   :200.7  \n NA's   :84      NA's   :1839    NA's   :1853     NA's   :1812   \n    BMXWAIST        SBP_mean        DBP_mean          LBXGH       \n Min.   : 60.0   Min.   : 70.0   Min.   : 34.00   Min.   : 3.200  \n 1st Qu.: 89.0   1st Qu.:110.7   1st Qu.: 67.33   1st Qu.: 5.200  \n Median : 99.7   Median :120.5   Median : 74.00   Median : 5.500  \n Mean   :101.2   Mean   :123.0   Mean   : 74.70   Mean   : 5.774  \n 3rd Qu.:111.5   3rd Qu.:132.7   3rd Qu.: 81.33   3rd Qu.: 5.900  \n Max.   :187.0   Max.   :232.3   Max.   :139.00   Max.   :17.100  \n NA's   :2104    NA's   :1947    NA's   :1949     NA's   :2090    \n     LBXTC      \n Min.   : 62.0  \n 1st Qu.:159.0  \n Median :185.0  \n Mean   :188.2  \n 3rd Qu.:214.0  \n Max.   :438.0  \n NA's   :2318   \n```\n\n\n:::\n:::\n\n\n2\\) Histogram of age distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(nhanes, aes(x = RIDAGEYR)) +\n  geom_histogram(bins = 30, fill = \"purple\", color = \"black\") +\n  labs(\n    title = \"Distribution of Age (Adults Only)\",\n    x = \"Age (years)\",\n    y = \"Count\") + theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 84 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n3\\) Histogram of BMI distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(nhanes, aes(x = BMXBMI)) +\n  geom_histogram(bins = 30, fill = \"darkred\", color = \"black\") +\n  labs(title = \"Distribution of BMI\",\n       x = \"BMI\", y = \"Count\") + theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1839 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n4\\) Histogram of mean SBP distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(nhanes, aes(x = SBP_mean)) +\n  geom_histogram(bins = 30, fill = \"lightyellow\", color = \"black\") +\n  labs(title = \"Distribution of Mean Systolic Blood Pressure\",\n       x = \"Mean SBP (mmHg)\", y = \"Count\") + theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1947 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n5\\) Histogram of mean DBP distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(nhanes, aes(x = DBP_mean)) +\n  geom_histogram(bins = 30, fill = \"yellow\", color = \"black\") +\n  labs(title = \"Distribution of Mean Diastolic Blood Pressure\",\n       x = \"Mean DBP (mmHg)\", y = \"Count\") + theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1949 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n6\\) Histogram of total cholestreol distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(nhanes, aes(x = LBXTC)) +\n  geom_histogram(bins = 30, fill = \"pink\", color = \"black\") +\n  labs(title = \"Distribution of Total Cholesterol\",\n       x = \"Total Cholesterol\", y = \"Count\") + theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 2318 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n7\\) Histogram of HbA1C distribution\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(nhanes, aes(x = LBXGH)) +\n  geom_histogram(bins = 30, fill = \"skyblue\", color = \"black\") +\n  labs(title = \"Distribution of HbA1c\",\n       x = \"HbA1c (%)\", y = \"Count\") + theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 2090 rows containing non-finite outside the scale range\n(`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n8\\) Correlation Matrix Heatmap\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnum_vars <- nhanes %>%\n  select(\n    RIDAGEYR,   # Age\n    BMXBMI,     # BMI\n    BMXWAIST,   # Waist circumference\n    SBP_mean,   # Systolic BP\n    DBP_mean,   # Diastolic BP\n    LBXGH,      # HbA1c\n    LBXTC       # Total cholesterol\n  )\n\ncorr_matrix <- cor(num_vars, use = \"pairwise.complete.obs\")\n\ncorrplot(corr_matrix,\n         method = \"color\",\n         type   = \"upper\",\n         tl.col = \"black\",\n         tl.cex = 0.9,\n         title  = \"Correlation Between Key Health Variables\",\n         mar    = c(0,0,2,0))\n```\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n#### Answering research questions\n\n#### RQ1)\n\n1\\) Setting up library\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyr)\nnhanes_rq1 <- nhanes %>%\n  mutate(\n    diabetes = ifelse(DIQ010 == 1, 1, 0)\n  ) %>%\n  drop_na(BMXBMI, diabetes)\n```\n:::\n\n\n2\\) Logistic regression model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_rq1 <- glm(diabetes ~ BMXBMI, data = nhanes_rq1, family = \"binomial\")\nsummary(model_rq1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = diabetes ~ BMXBMI, family = \"binomial\", data = nhanes_rq1)\n\nCoefficients:\n             Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -3.612837   0.150813  -23.96   <2e-16 ***\nBMXBMI       0.058362   0.004556   12.81   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 4861.3  on 5969  degrees of freedom\nResidual deviance: 4702.2  on 5968  degrees of freedom\nAIC: 4706.2\n\nNumber of Fisher Scoring iterations: 4\n```\n\n\n:::\n\n```{.r .cell-code}\nprev_bmi <- nhanes_rq1 %>%\n  mutate(bmi_group = cut(\n    BMXBMI,\n    breaks = c(-Inf, 18.5, 25, 30, 35, Inf),\n    labels = c(\"Underweight\", \"Normal\", \"Overweight\", \"Obese\", \"Severe Obese\")\n  )) %>%\n  group_by(bmi_group) %>%\n  summarize(\n    total = n(),\n    diabetes_cases = sum(diabetes == 1),\n    prevalence = diabetes_cases / total\n  )\n```\n:::\n\n\n3\\) Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(prev_bmi, aes(x = bmi_group, y = prevalence)) +\n  geom_col(fill = \"darkblue\") +\n  geom_text(aes(label = round(prevalence, 3)), vjust = -0.4) +\n  labs(title = \"Diabetes Prevalence by BMI Category\",\n       x = \"BMI Category\",\n       y = \"Prevalence of Diabetes\") + theme_minimal()\n```\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n#### RQ 2)\n\n1\\) Initial set up\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes_rq2 <- nhanes %>%\n  select(\n    SEQN,\n    RIDAGEYR,        # Age\n    RIAGENDR,        # Gender\n    RIDRETH3,        # Race/Ethnicity\n    INDFMPIR,        # Income ratio\n    DMDEDUC2,        # Education\n    BMXBMI,          # BMI\n    BMXWT,           # Weight\n    BMXHT,           # Height\n    BMXWAIST,        # Waist circumference\n    SBP_mean,        # Systolic BP\n    DBP_mean,        # Diastolic BP\n    LBXGH,           # HbA1c\n    LBXTC,           # Total cholesterol\n    diabetes,        # Diabetes (0/1)\n    smoker_ever      # Smoking (0/1)\n  ) %>%\n  drop_na(RIDAGEYR, BMXBMI, LBXGH, LBXTC, SBP_mean, DBP_mean)\nlog_r2 <- nhanes_rq2 %>%\n  drop_na(\n    diabetes,\n    BMXBMI, SBP_mean, DBP_mean,\n    LBXGH, LBXTC, smoker_ever\n  )\n```\n:::\n\n\n2\\) Regression model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_rq2 <- glm(\n  diabetes ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = log_r2,\n  family = \"binomial\"\n)\nsummary(model_rq2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = diabetes ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + \n    LBXTC + smoker_ever, family = \"binomial\", data = log_r2)\n\nCoefficients:\n              Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -13.384834   0.727232 -18.405  < 2e-16 ***\nBMXBMI        0.045553   0.008362   5.448 5.10e-08 ***\nSBP_mean      0.018959   0.003937   4.816 1.47e-06 ***\nDBP_mean     -0.036323   0.006810  -5.334 9.61e-08 ***\nLBXGH         2.175551   0.090864  23.943  < 2e-16 ***\nLBXTC        -0.015141   0.001587  -9.541  < 2e-16 ***\nsmoker_ever   0.122853   0.120768   1.017    0.309    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 3983.3  on 4985  degrees of freedom\nResidual deviance: 2009.4  on 4979  degrees of freedom\nAIC: 2023.4\n\nNumber of Fisher Scoring iterations: 6\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npred_prob <- predict(model_rq2, type = \"response\")\npred_class <- ifelse(pred_prob > 0.5, 1, 0)\n\ntable(Predicted = pred_class, Actual = log_r2$diabetes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         Actual\nPredicted    0    1\n        0 4247  271\n        1   56  412\n```\n\n\n:::\n:::\n\n\n3\\) Tree\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tree)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'tree' was built under R version 4.5.2\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntree_rq2 <- tree(factor(diabetes) ~ BMXBMI + SBP_mean + DBP_mean +\n                   LBXGH + LBXTC + smoker_ever,\n                 data = log_r2)\n\nplot(tree_rq2)\ntext(tree_rq2, pretty = 0)\n```\n\n::: {.cell-output-display}\n![](codes_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\n#### RQ 3)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnhanes_rq3 <- nhanes %>%\n  mutate(\n    high_risk = ifelse(\n      LBXGH >= 5.7 | BMXBMI >= 30 | SBP_mean >= 130 | LBXTC >= 200,\n      1, 0\n    )\n  ) %>%\n  select(BMXBMI, SBP_mean, DBP_mean, LBXGH, LBXTC, smoker_ever, high_risk) %>%\n  drop_na()\n```\n:::\n\n\n2\\) Regression model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel_rq3 <- glm(\n  high_risk ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = nhanes_rq3,\n  family = \"binomial\"\n)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: glm.fit: fitted probabilities numerically 0 or 1 occurred\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(model_rq3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = high_risk ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + \n    LBXTC + smoker_ever, family = \"binomial\", data = nhanes_rq3)\n\nCoefficients:\n              Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -38.267231   1.347063 -28.408   <2e-16 ***\nBMXBMI        0.310497   0.014172  21.909   <2e-16 ***\nSBP_mean      0.079326   0.005235  15.154   <2e-16 ***\nDBP_mean     -0.017255   0.007484  -2.306   0.0211 *  \nLBXGH         2.845993   0.150698  18.885   <2e-16 ***\nLBXTC         0.042748   0.001912  22.355   <2e-16 ***\nsmoker_ever   0.272456   0.109407   2.490   0.0128 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 5189.7  on 5223  degrees of freedom\nResidual deviance: 2363.2  on 5217  degrees of freedom\nAIC: 2377.2\n\nNumber of Fisher Scoring iterations: 7\n```\n\n\n:::\n\n```{.r .cell-code}\nprob3 <- predict(model_rq3, type = \"response\")\npred3 <- ifelse(prob3 > 0.5, 1, 0)\n\ntable(Predicted = pred3, Actual = nhanes_rq3$high_risk)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         Actual\nPredicted    0    1\n        0  696  202\n        1  335 3991\n```\n\n\n:::\n:::\n\n\n3\\) Random Forest Model\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(randomForest)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: package 'randomForest' was built under R version 4.5.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nrandomForest 4.7-1.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nType rfNews() to see new features/changes/bug fixes.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'randomForest'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:ggplot2':\n\n    margin\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:dplyr':\n\n    combine\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_rq3 <- randomForest(\n  factor(high_risk) ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = nhanes_rq3,\n  ntree = 200,\n  mtry = 3\n)\nrf_rq3\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\n randomForest(formula = factor(high_risk) ~ BMXBMI + SBP_mean +      DBP_mean + LBXGH + LBXTC + smoker_ever, data = nhanes_rq3,      ntree = 200, mtry = 3) \n               Type of random forest: classification\n                     Number of trees: 200\nNo. of variables tried at each split: 3\n\n        OOB estimate of  error rate: 0%\nConfusion matrix:\n     0    1 class.error\n0 1031    0           0\n1    0 4193           0\n```\n\n\n:::\n:::\n\n",
    "supporting": [
      "codes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}