{"title":"Methodology and Results","markdown":{"yaml":{"title":"Methodology and Results","format":"html"},"headingText":"Methodology","containsRefs":false,"markdown":"\n\nIn this page, We shall discuss the methodology used in our project and discuss the findings and results.\n\n\n#### I. SELECTION OF DATASET\n\nIn this project, We first selected our dataset from the 2021-2023 NHANES dataset. We then chose the following variables from the sub-datasets.\n\n1.  ***DEMO_L (demographic dataset)***\n\n    1.  **SEQN** → unique ID;\n\n    2.  **RIDAGEYR** → age in years;\n\n    3.  **RIAGENDR** → sex (1=male, 2=female);\n\n    4.  **RIDRETH3** → race/ethnicity;\n\n    5.  **INDFMPIR** → income-to-poverty ratio;\n\n    6.  **DMDMARTZ** → marital status;\n\n    7.  **DMDEDUC2** → education level;\n\nThese are predictors for chronic diseases.\n\n2.  ***BMX_L (BMI/ Body measurements)***\n\n    1.  **BMXWT** → weight\n\n    2.  **BMXHT** → height\n\n    3.  **BMXBMI** → BMI (body mass index)\n\n    4.  **BMXWAIST** → waist circumference\n\nThese variables are important as they are major risk factors for diabetes, hypertension, and heart disease.\n\n3.  ***BPXO_L (Blood pressure)***\n\n    1.  **OSBP** → systolic BP\n\n    2.  **ODBP** → diastolic BP\n\n    3.  **OSBPA**, **ODBPA** → averaged readings\n\nThese variables are important because blood pressure is a chronic disease indicator and a strong predictor for cardiovascular risk.\n\n4.  ***GHB_L (Glycohemaglobin)***\n\n    1.  **LBXGH** → HbA1c (%)\n\nThis variable is used to detect diabetes.\n\n5.  ***TCHOL_L (Total cholesterol)***\n\n    1.  **LBXTC** → total cholesterol (mg/dL)\n\nThis variable is a chronic disease predictor\n\n6.  ***DIQ_L (diabetes questionnaire)***\n\n    1.  **DIQ010** → “Doctor diagnosed diabetes?” (1=yes/ 2=no)\n\n    2.  **DIQ160** → “Borderline diabetes?”\n\n    3.  **DIQ050** → taking insulin?\n\nThis variable gives the main binary outcome for logistic regression.\n\n7.  ***SMQ_L (smoking questionnaire)***\n\n    1.  **SMQ020** → smoked at least 100 cigarettes\n\nThis variable is useful because smoking is a huge risk factor for many diseases and is a strong predictor.\n\n\\* We limited our dataset to include only adults (20 years and above) as major health risks are more likely to occur in them and including children could cause biases.\n\n#### II. Setting up dataset in RStudio\n\nAfter converting the .xpt file to a csv file using the \"haven\". We cleaned up our data and selected only the important variables which will be used during the project.\n\n```{r}\n#| echo: false\n\n#install.packages(\"haven\")\n#install.packages(\"dplyr\")\n\nlibrary(haven) \nlibrary(dplyr)\n\nbase <- \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/\"\n\nread_nhanes <- function(stub) {\n  url_full <- paste0(base, stub, \".xpt\")\n  read_xpt(url_full)\n}\n\ndemo  <- read_nhanes(\"DEMO_L\")\nbmx   <- read_nhanes(\"BMX_L\")\nbpxo  <- read_nhanes(\"BPXO_L\")\nghb   <- read_nhanes(\"GHB_L\")\ntchol <- read_nhanes(\"TCHOL_L\")\ndiq   <- read_nhanes(\"DIQ_L\")\nsmq   <- read_nhanes(\"SMQ_L\")\n\nnhanes_all <- demo %>%\n  left_join(bmx, by=\"SEQN\") %>%\n  left_join(bpxo, by=\"SEQN\") %>%\n  left_join(ghb, by=\"SEQN\") %>%\n  left_join(tchol, by=\"SEQN\") %>%\n  left_join(diq, by=\"SEQN\") %>%\n  left_join(smq, by=\"SEQN\")\n\nnhanes_adults <- nhanes_all %>%\n  filter(RIDAGEYR >= 20 | is.na(RIDAGEYR))\n\nwrite.csv(nhanes_adults,\n          \"nhanes_2021_2023_chronic_disease.csv\",\n          row.names = FALSE)\n```\n\n```{r}\ndata <- read.csv(\"nhanes_2021_2023_chronic_disease.csv\")\nhead(data)\n```\n\n#### III. Setting up libraries for visualization and removing missing values and special codes.\n\nNHANES uses special codes such as \"777\", \"999\", or \"refused\", \"NA\". and many more. We cleaned the new dataset to ensure there were no missing or invalid values. We also removed any duplicate values\n\n```{r}\n#| echo: false\nlibrary(ggplot2)\n#install.packages(\"corrplot\")\nlibrary(corrplot)\n\ncat(\"Original rows:\", nrow(data), \"\\n\")\ncat(\"Original columns:\", ncol(data), \"\\n\")\n\n#removal of any duplicate rows\n\nnhanes_clean <- data %>%\n  distinct()\n\ncat(\"Rows after removing duplicate:\", nrow(nhanes_clean), \"\\n\")\n#no duplicate rows\n\n# Convert nhanes codes to numeric\n# NHANES often uses these codes for \"Refused/Don't know/Missing\"\nspecial_codes <- c(\n  7, 8, 9,\n  77, 88, 99,\n  777, 888, 999,\n  7777, 8888, 9999\n)\nmissing_codes <- c(\n  \"Refused\",\n  \"Don't know\",\n  \"Missing\",\n  \"Blank but applicable\",\n  \"NA\",\n  \"\"\n)\n\nnhanes <- nhanes_clean %>%\n  mutate(\n    across(\n      .cols = where(is.numeric),\n      .fns  = ~ ifelse(.x %in% special_codes, NA_real_, .x)\n    ),\n    across(\n      .cols = where(is.character),\n      .fns  = ~ ifelse(.x %in% missing_codes, NA_character_, .x)\n    )\n  )\n```\n\n#### IV. Setting up key health variables\n\n```{r}\n#| echo: false\n#Blood pressure means\nnhanes <- nhanes %>%\n  mutate(\n    SBP_mean = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),\n    DBP_mean = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)\n  )\n\n#Diabetes indicator (DIQ010: 1 = Yes, 2 = No)\nnhanes <- nhanes %>%\n  mutate(\n    diabetes = case_when(\n      DIQ010 == 1 ~ 1,\n      DIQ010 == 2 ~ 0,\n      TRUE        ~ NA_real_\n    )\n  )\n\n#Smoking status:smoked 100 cigarettes (SMQ020: 1 = Yes, 2 = No)\nnhanes <- nhanes %>%\n  mutate(\n    smoker_ever = case_when(\n      SMQ020 == 1 ~ 1,\n      SMQ020 == 2 ~ 0,\n      TRUE        ~ NA_real_\n    )\n  )\n\nwrite.csv(nhanes, \"nhanes_2021_2023_chronic_disease_clean.csv\", row.names = FALSE)\n```\n\n#### V. Conduction Basic Exploratory Analysis\n\nWe selected a few variables from the new dataset such as: RIDAGEYR, BMXBMI, BMXWT, BMXHT, BMXWAIST, SBP_mean, DBP_mean, LBXGH, LBXTC.\n\n```{r}\n#| echo: false\nsummary_vars <- nhanes %>%\n  select(\n    RIDAGEYR,      # Age\n    BMXBMI,        # BMI\n    BMXWT,         # Weight\n    BMXHT,         # Height\n    BMXWAIST,      # Waist circumference\n    SBP_mean,      # Systolic BP\n    DBP_mean,      # Diastolic BP\n    LBXGH,         # HbA1c\n    LBXTC          # Total Cholesterol\n  )\n\n```\n\n```{r}\nsummary(summary_vars)\n```\n\nThis statistical summary helps us quickly go through and understand the minimum, maximum and mean values of each variable.\n\nWe then created some visualizations to help understand the variables clearly.\n\n1.  Age Distribution Histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = RIDAGEYR)) +\n      geom_histogram(bins = 30, fill = \"steelblue\", color = \"black\") +\n      labs(\n        title = \"Distribution of Age (Adults Only)\",\n        x = \"Age (years)\",\n        y = \"Count\") + theme_minimal()\n    ```\n\n    This histogram helps us visually understand the age range of the individuals in the dataset. As we can see, there are more counts as the age increases.\n\n2.  BMI Distribution Histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = BMXBMI)) +\n      geom_histogram(bins = 30, fill = \"darkred\", color = \"black\") +\n      labs(title = \"Distribution of BMI\",\n           x = \"BMI\", y = \"Count\") + theme_minimal()\n    ```\n\n    This histogram shows that the graph is right-skewed. Most of the adults fall between 20 to 40 range.\n\n3.  Mean SBP histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = SBP_mean)) +\n      geom_histogram(bins = 30, fill = \"lightyellow\", color = \"black\") +\n      labs(title = \"Distribution of Mean Systolic Blood Pressure\",\n           x = \"Mean SBP (mmHg)\", y = \"Count\") + theme_minimal()\n    ```\n\nThis histogram shows a roughly normal distribution between 120 mmHg and 150 mmHg\n\n4.  Mean DBP histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = DBP_mean)) +\n      geom_histogram(bins = 30, fill = \"yellow\", color = \"black\") +\n      labs(title = \"Distribution of Mean Diastolic Blood Pressure\",\n           x = \"Mean DBP (mmHg)\", y = \"Count\") + theme_minimal()\n    ```\n\nThis histogram shows a distribution of the Diastolic blood pressure between 60 mmHg and 90 mmHg.\n\n5.  Total Cholesterol Distribution\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = LBXTC)) +\n      geom_histogram(bins = 30, fill = \"pink\", color = \"black\") +\n      labs(title = \"Distribution of Total Cholesterol\",\n           x = \"Total Cholesterol\", y = \"Count\") + theme_minimal()\n    ```\n\n    This histogram shows that it peaks around 180-220 mg/dL.\n\n6.  HbA1c Distribution Histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = LBXGH)) +\n      geom_histogram(bins = 30, fill = \"skyblue\", color = \"black\") +\n      labs(title = \"Distribution of HbA1c\",\n           x = \"HbA1c (%)\", y = \"Count\") + theme_minimal()\n    ```\n\nThis histogram are heavily concentrated between 5% to 6%.\n\n7.  Correlation Matrix Heatmap\n\n    ```{r}\n    #| echo: false\n    num_vars <- nhanes %>%\n      select(\n        RIDAGEYR,   # Age\n        BMXBMI,     # BMI\n        BMXWAIST,   # Waist circumference\n        SBP_mean,   # Systolic BP\n        DBP_mean,   # Diastolic BP\n        LBXGH,      # HbA1c\n        LBXTC       # Total cholesterol\n      )\n\n    # Correlation matrix (pairwise complete obs ignores NAs)\n    corr_matrix <- cor(num_vars, use = \"pairwise.complete.obs\")\n    ```\n\n```{r}\n#| echo: false\n# Correlation heatmap\ncorrplot(corr_matrix,\n         method = \"color\",\n         type   = \"upper\",\n         tl.col = \"black\",\n         tl.cex = 0.9,\n         title  = \"Correlation Between Key Health Variables\",\n         mar    = c(0,0,2,0))\n```\n\nThe correlation heatmap shows that BMI and waist circumference are strongly correlated, while blood pressure and cholesterol show moderate positive relationships with other metabolic indicators.\n\n#### VI. Answering Research Questions\n\n**(i)** Our first research question explores how BMI influences the risk of diabetes among adults. We first created a binary variable which indicates if a person has diabetes or not (based on the DIQ010 variable), where 1 = Diabetes and 0 = No Diabetes. We also dropped any values which were not available or missing. We then fit a logistic regression model with the diabetes as the response variable and the BMI as the predictor. The aim of this model is to predict if the chances of diabetes increases with BMI.\n\nWe also grouped the BMI values into 5 standard categories\\[3\\], **Underweight** (less than 18.5), **Normal** (between 18.5 and less than 25), **Overweight** (25 to less than 30), **Obese** ( 30 or greater) and **Severe Obese** (40 or greater).\n\nFor each BMI group we calculated the percentage of people with diabetes. We used a bar plot to visualize the result.\n\n```{r}\n#| echo: false\nlibrary(tidyr)\nnhanes_rq1 <- nhanes %>%\n  mutate(\n    diabetes = ifelse(DIQ010 == 1, 1, 0)\n  ) %>%\n  drop_na(BMXBMI, diabetes)\n\n# Logistic regression model\nmodel_rq1 <- glm(diabetes ~ BMXBMI, data = nhanes_rq1, family = \"binomial\")\nsummary(model_rq1)\n\nprev_bmi <- nhanes_rq1 %>%\n  mutate(bmi_group = cut(\n    BMXBMI,\n    breaks = c(-Inf, 18.5, 25, 30, 35, Inf),\n    labels = c(\"Underweight\", \"Normal\", \"Overweight\", \"Obese\", \"Severe Obese\")\n  )) %>%\n  group_by(bmi_group) %>%\n  summarize(\n    total = n(),\n    diabetes_cases = sum(diabetes == 1),\n    prevalence = diabetes_cases / total\n  )\n\nggplot(prev_bmi, aes(x = bmi_group, y = prevalence)) +\n  geom_col(fill = \"steelblue\") +\n  geom_text(aes(label = round(prevalence, 3)), vjust = -0.4) +\n  labs(title = \"Diabetes Prevalence by BMI Category\",\n       x = \"BMI Category\",\n       y = \"Prevalence of Diabetes\") + theme_minimal()\n```\n\nThe logistic regression results show that BMI is a statistically significant predictor of diabetes (p \\< 2e-16). The positive coefficient (0.058) indicates that as BMI increases, the chances of having diabetes also increase. The barplot also helps us easily visualize the increase in the prevalence of diabetes as the BMI increases, with the normal category having a 0.07% chance of diabetes and the severe obese category having a 0.22% chance of diabetes.\n\n**(ii)** In our second research question, we explore and try to answer if we can predict diabetes using health risk factors such as BMI, HbA1c, blood pressure, cholesterol, and smoking status.\n\nWe selected another subset of variables to fit a logistic regression model. We then generated predicted probabilities and classified individuals as diabetic or non-diabetic, which allowed us to compare predicted versus actual outcomes through a confusion matrix. This model lets us to assess how each risk factor influences the likelihood of developing diabetes while accounting for the others.\n\nWe then created a classification tree with the same predictors to see how the variables split the data and which factors were most relevant for prediction. This tree is a simple graphical representation of the decision criteria that distinguish diabetics from non-diabetics. Together, these steps allows us to evaluate both statistical significance and prediction accuracy for diabetes risk.\n\n```{r}\n#| echo: false\nnhanes_rq2 <- nhanes %>%\n  select(\n    SEQN,\n    RIDAGEYR,        # Age\n    RIAGENDR,        # Gender\n    RIDRETH3,        # Race/Ethnicity\n    INDFMPIR,        # Income ratio\n    DMDEDUC2,        # Education\n    BMXBMI,          # BMI\n    BMXWT,           # Weight\n    BMXHT,           # Height\n    BMXWAIST,        # Waist circumference\n    SBP_mean,        # Systolic BP\n    DBP_mean,        # Diastolic BP\n    LBXGH,           # HbA1c\n    LBXTC,           # Total cholesterol\n    diabetes,        # Diabetes (0/1)\n    smoker_ever      # Smoking (0/1)\n  ) %>%\n  drop_na(RIDAGEYR, BMXBMI, LBXGH, LBXTC, SBP_mean, DBP_mean)\nlog_r2 <- nhanes_rq2 %>%\n  drop_na(\n    diabetes,\n    BMXBMI, SBP_mean, DBP_mean,\n    LBXGH, LBXTC, smoker_ever\n  )\n\nmodel_rq2 <- glm(\n  diabetes ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = log_r2,\n  family = \"binomial\"\n)\nsummary(model_rq2)\n\npred_prob <- predict(model_rq2, type = \"response\")\npred_class <- ifelse(pred_prob > 0.5, 1, 0)\n\ntable(Predicted = pred_class, Actual = log_r2$diabetes)\n\nlibrary(tree)\n\ntree_rq2 <- tree(factor(diabetes) ~ BMXBMI + SBP_mean + DBP_mean +\n                   LBXGH + LBXTC + smoker_ever,\n                 data = log_r2)\n\nplot(tree_rq2)\ntext(tree_rq2, pretty = 0)\n```\n\nThe logistic regression results demonstrate that HbA1c (LBXGH) is the most powerful predictor of diabetes, with a large and highly significant coefficient (2.1755). BMI, systolic blood pressure, and cholesterol are all significant predictors of diabetes, but smoking status is not. The confusion matrix demonstrates that the model performs well overall: it properly categorised 4,247 non-diabetic individuals and 412 diabetic individuals, with just 271 false negatives and 56 false positives. With an accuracy of 93%. This suggests that the model can reasonably differentiate between diabetic and non-diabetic patients.\n\nThe tree also demonstrates that HbA1c is the main variable which splits the individuals into diabetic or non diabetic groups. If the A1c (blood glucose/sugar) value is less than 5.7, it is normal, but if it is greater than 6.5, the person is diabetic \\[4\\].\n\n**(iii)** In our third and final research question, we try to find if we can properly classify individuals into high vs low metabolic risk groups. To answer this question we created a new variable \"high_risk\". Indivizuals were going to be labeled high risk if they met the clinical points. That is, if their :\n\n-   AC1 levels (blood glucose levels, LBXGH) were 5.7 or higher \\[4\\];\n\n-   BMI levels (BMXMBI levels) were 30 or higher \\[3\\];\n\n-   Systolic blood pressure (SBP_mean) were 130 or higher \\[5\\];\n\n-   Total Cholesterol levels ( LBXTC) were 200 or higher \\[6\\].\n\n    We then chose the relevant predictors and used a logistic regression model to determine what factors predicted a high metabolic risk strongly. We also built a confusion matrix to assess how effectively the model predicted high- and low-risk individuals. Finally, we trained a random forest model to compare results and see whether a more flexible model increases prediction accuracy.\n\n```{r}\n#| echo: false\nnhanes_rq3 <- nhanes %>%\n  mutate(\n    high_risk = ifelse(\n      LBXGH >= 5.7 | BMXBMI >= 30 | SBP_mean >= 130 | LBXTC >= 200,\n      1, 0\n    )\n  ) %>%\n  select(BMXBMI, SBP_mean, DBP_mean, LBXGH, LBXTC, smoker_ever, high_risk) %>%\n  drop_na()\n\nmodel_rq3 <- glm(\n  high_risk ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = nhanes_rq3,\n  family = \"binomial\"\n)\n\nsummary(model_rq3)\nprob3 <- predict(model_rq3, type = \"response\")\npred3 <- ifelse(prob3 > 0.5, 1, 0)\n\ntable(Predicted = pred3, Actual = nhanes_rq3$high_risk)\n\nlibrary(randomForest)\n\nrf_rq3 <- randomForest(\n  factor(high_risk) ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = nhanes_rq3,\n  ntree = 200,\n  mtry = 3\n)\n\nrf_rq3\n```\n\nThe logistic regression results indicates that all clinical factors are strong predictors of metabolic risk, particularly HbA1c, cholesterol, BMI and systolic blood pressure. All predictors had significant p-values(p\\<0.001), suggesting they do help identify individuals at high metabolic risk.\n\nThe confusion matrix also shows that the logistic model performs effectively, correctly identifying 696 low-risk and 3991 high-risk people, with only small misclassification in the low-risk group. This indicates that the model is very good at detecting high-risk individuals but less accurate for low-risk ones. The random forest model also performs extraordinarily well, with an error rate of 0%, indicating that it correctly identified all individuals in this sample.\n\n## Results\n\nAfter answering all the three research questions, our analysis showed that health factors such as BMI, HbA1c, blood pressure and cholesterol levels are very strong predictors of diabetes and overall metabolic risk. We were able to prove that BMI played a role in the prevalence of diabetes. Using a multivariable logistic model for diabetes prediction helps us analyse that HbA1c is the most influential predictor. The model not only performed well but also had an accuracy of 93%. The high and low risk classification model also showed a great performance as it achieved perfect accuracy.\n\n*NOTE: The random forest model has a 0% error rate since the high-risk variable was created with the same variables as the model (HbA1c, BMI, blood pressure, and cholesterol). Because these clinical cutoffs establish risk status, the random forest could exactly reproduce this rule. This outcome shows overfitting, rather than real prediction performance on unknown data.*\n","srcMarkdownNoYaml":"\n\nIn this page, We shall discuss the methodology used in our project and discuss the findings and results.\n\n## Methodology\n\n#### I. SELECTION OF DATASET\n\nIn this project, We first selected our dataset from the 2021-2023 NHANES dataset. We then chose the following variables from the sub-datasets.\n\n1.  ***DEMO_L (demographic dataset)***\n\n    1.  **SEQN** → unique ID;\n\n    2.  **RIDAGEYR** → age in years;\n\n    3.  **RIAGENDR** → sex (1=male, 2=female);\n\n    4.  **RIDRETH3** → race/ethnicity;\n\n    5.  **INDFMPIR** → income-to-poverty ratio;\n\n    6.  **DMDMARTZ** → marital status;\n\n    7.  **DMDEDUC2** → education level;\n\nThese are predictors for chronic diseases.\n\n2.  ***BMX_L (BMI/ Body measurements)***\n\n    1.  **BMXWT** → weight\n\n    2.  **BMXHT** → height\n\n    3.  **BMXBMI** → BMI (body mass index)\n\n    4.  **BMXWAIST** → waist circumference\n\nThese variables are important as they are major risk factors for diabetes, hypertension, and heart disease.\n\n3.  ***BPXO_L (Blood pressure)***\n\n    1.  **OSBP** → systolic BP\n\n    2.  **ODBP** → diastolic BP\n\n    3.  **OSBPA**, **ODBPA** → averaged readings\n\nThese variables are important because blood pressure is a chronic disease indicator and a strong predictor for cardiovascular risk.\n\n4.  ***GHB_L (Glycohemaglobin)***\n\n    1.  **LBXGH** → HbA1c (%)\n\nThis variable is used to detect diabetes.\n\n5.  ***TCHOL_L (Total cholesterol)***\n\n    1.  **LBXTC** → total cholesterol (mg/dL)\n\nThis variable is a chronic disease predictor\n\n6.  ***DIQ_L (diabetes questionnaire)***\n\n    1.  **DIQ010** → “Doctor diagnosed diabetes?” (1=yes/ 2=no)\n\n    2.  **DIQ160** → “Borderline diabetes?”\n\n    3.  **DIQ050** → taking insulin?\n\nThis variable gives the main binary outcome for logistic regression.\n\n7.  ***SMQ_L (smoking questionnaire)***\n\n    1.  **SMQ020** → smoked at least 100 cigarettes\n\nThis variable is useful because smoking is a huge risk factor for many diseases and is a strong predictor.\n\n\\* We limited our dataset to include only adults (20 years and above) as major health risks are more likely to occur in them and including children could cause biases.\n\n#### II. Setting up dataset in RStudio\n\nAfter converting the .xpt file to a csv file using the \"haven\". We cleaned up our data and selected only the important variables which will be used during the project.\n\n```{r}\n#| echo: false\n\n#install.packages(\"haven\")\n#install.packages(\"dplyr\")\n\nlibrary(haven) \nlibrary(dplyr)\n\nbase <- \"https://wwwn.cdc.gov/Nchs/Data/Nhanes/Public/2021/DataFiles/\"\n\nread_nhanes <- function(stub) {\n  url_full <- paste0(base, stub, \".xpt\")\n  read_xpt(url_full)\n}\n\ndemo  <- read_nhanes(\"DEMO_L\")\nbmx   <- read_nhanes(\"BMX_L\")\nbpxo  <- read_nhanes(\"BPXO_L\")\nghb   <- read_nhanes(\"GHB_L\")\ntchol <- read_nhanes(\"TCHOL_L\")\ndiq   <- read_nhanes(\"DIQ_L\")\nsmq   <- read_nhanes(\"SMQ_L\")\n\nnhanes_all <- demo %>%\n  left_join(bmx, by=\"SEQN\") %>%\n  left_join(bpxo, by=\"SEQN\") %>%\n  left_join(ghb, by=\"SEQN\") %>%\n  left_join(tchol, by=\"SEQN\") %>%\n  left_join(diq, by=\"SEQN\") %>%\n  left_join(smq, by=\"SEQN\")\n\nnhanes_adults <- nhanes_all %>%\n  filter(RIDAGEYR >= 20 | is.na(RIDAGEYR))\n\nwrite.csv(nhanes_adults,\n          \"nhanes_2021_2023_chronic_disease.csv\",\n          row.names = FALSE)\n```\n\n```{r}\ndata <- read.csv(\"nhanes_2021_2023_chronic_disease.csv\")\nhead(data)\n```\n\n#### III. Setting up libraries for visualization and removing missing values and special codes.\n\nNHANES uses special codes such as \"777\", \"999\", or \"refused\", \"NA\". and many more. We cleaned the new dataset to ensure there were no missing or invalid values. We also removed any duplicate values\n\n```{r}\n#| echo: false\nlibrary(ggplot2)\n#install.packages(\"corrplot\")\nlibrary(corrplot)\n\ncat(\"Original rows:\", nrow(data), \"\\n\")\ncat(\"Original columns:\", ncol(data), \"\\n\")\n\n#removal of any duplicate rows\n\nnhanes_clean <- data %>%\n  distinct()\n\ncat(\"Rows after removing duplicate:\", nrow(nhanes_clean), \"\\n\")\n#no duplicate rows\n\n# Convert nhanes codes to numeric\n# NHANES often uses these codes for \"Refused/Don't know/Missing\"\nspecial_codes <- c(\n  7, 8, 9,\n  77, 88, 99,\n  777, 888, 999,\n  7777, 8888, 9999\n)\nmissing_codes <- c(\n  \"Refused\",\n  \"Don't know\",\n  \"Missing\",\n  \"Blank but applicable\",\n  \"NA\",\n  \"\"\n)\n\nnhanes <- nhanes_clean %>%\n  mutate(\n    across(\n      .cols = where(is.numeric),\n      .fns  = ~ ifelse(.x %in% special_codes, NA_real_, .x)\n    ),\n    across(\n      .cols = where(is.character),\n      .fns  = ~ ifelse(.x %in% missing_codes, NA_character_, .x)\n    )\n  )\n```\n\n#### IV. Setting up key health variables\n\n```{r}\n#| echo: false\n#Blood pressure means\nnhanes <- nhanes %>%\n  mutate(\n    SBP_mean = rowMeans(select(., BPXOSY1, BPXOSY2, BPXOSY3), na.rm = TRUE),\n    DBP_mean = rowMeans(select(., BPXODI1, BPXODI2, BPXODI3), na.rm = TRUE)\n  )\n\n#Diabetes indicator (DIQ010: 1 = Yes, 2 = No)\nnhanes <- nhanes %>%\n  mutate(\n    diabetes = case_when(\n      DIQ010 == 1 ~ 1,\n      DIQ010 == 2 ~ 0,\n      TRUE        ~ NA_real_\n    )\n  )\n\n#Smoking status:smoked 100 cigarettes (SMQ020: 1 = Yes, 2 = No)\nnhanes <- nhanes %>%\n  mutate(\n    smoker_ever = case_when(\n      SMQ020 == 1 ~ 1,\n      SMQ020 == 2 ~ 0,\n      TRUE        ~ NA_real_\n    )\n  )\n\nwrite.csv(nhanes, \"nhanes_2021_2023_chronic_disease_clean.csv\", row.names = FALSE)\n```\n\n#### V. Conduction Basic Exploratory Analysis\n\nWe selected a few variables from the new dataset such as: RIDAGEYR, BMXBMI, BMXWT, BMXHT, BMXWAIST, SBP_mean, DBP_mean, LBXGH, LBXTC.\n\n```{r}\n#| echo: false\nsummary_vars <- nhanes %>%\n  select(\n    RIDAGEYR,      # Age\n    BMXBMI,        # BMI\n    BMXWT,         # Weight\n    BMXHT,         # Height\n    BMXWAIST,      # Waist circumference\n    SBP_mean,      # Systolic BP\n    DBP_mean,      # Diastolic BP\n    LBXGH,         # HbA1c\n    LBXTC          # Total Cholesterol\n  )\n\n```\n\n```{r}\nsummary(summary_vars)\n```\n\nThis statistical summary helps us quickly go through and understand the minimum, maximum and mean values of each variable.\n\nWe then created some visualizations to help understand the variables clearly.\n\n1.  Age Distribution Histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = RIDAGEYR)) +\n      geom_histogram(bins = 30, fill = \"steelblue\", color = \"black\") +\n      labs(\n        title = \"Distribution of Age (Adults Only)\",\n        x = \"Age (years)\",\n        y = \"Count\") + theme_minimal()\n    ```\n\n    This histogram helps us visually understand the age range of the individuals in the dataset. As we can see, there are more counts as the age increases.\n\n2.  BMI Distribution Histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = BMXBMI)) +\n      geom_histogram(bins = 30, fill = \"darkred\", color = \"black\") +\n      labs(title = \"Distribution of BMI\",\n           x = \"BMI\", y = \"Count\") + theme_minimal()\n    ```\n\n    This histogram shows that the graph is right-skewed. Most of the adults fall between 20 to 40 range.\n\n3.  Mean SBP histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = SBP_mean)) +\n      geom_histogram(bins = 30, fill = \"lightyellow\", color = \"black\") +\n      labs(title = \"Distribution of Mean Systolic Blood Pressure\",\n           x = \"Mean SBP (mmHg)\", y = \"Count\") + theme_minimal()\n    ```\n\nThis histogram shows a roughly normal distribution between 120 mmHg and 150 mmHg\n\n4.  Mean DBP histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = DBP_mean)) +\n      geom_histogram(bins = 30, fill = \"yellow\", color = \"black\") +\n      labs(title = \"Distribution of Mean Diastolic Blood Pressure\",\n           x = \"Mean DBP (mmHg)\", y = \"Count\") + theme_minimal()\n    ```\n\nThis histogram shows a distribution of the Diastolic blood pressure between 60 mmHg and 90 mmHg.\n\n5.  Total Cholesterol Distribution\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = LBXTC)) +\n      geom_histogram(bins = 30, fill = \"pink\", color = \"black\") +\n      labs(title = \"Distribution of Total Cholesterol\",\n           x = \"Total Cholesterol\", y = \"Count\") + theme_minimal()\n    ```\n\n    This histogram shows that it peaks around 180-220 mg/dL.\n\n6.  HbA1c Distribution Histogram\n\n    ```{r}\n    #| echo: false\n    ggplot(nhanes, aes(x = LBXGH)) +\n      geom_histogram(bins = 30, fill = \"skyblue\", color = \"black\") +\n      labs(title = \"Distribution of HbA1c\",\n           x = \"HbA1c (%)\", y = \"Count\") + theme_minimal()\n    ```\n\nThis histogram are heavily concentrated between 5% to 6%.\n\n7.  Correlation Matrix Heatmap\n\n    ```{r}\n    #| echo: false\n    num_vars <- nhanes %>%\n      select(\n        RIDAGEYR,   # Age\n        BMXBMI,     # BMI\n        BMXWAIST,   # Waist circumference\n        SBP_mean,   # Systolic BP\n        DBP_mean,   # Diastolic BP\n        LBXGH,      # HbA1c\n        LBXTC       # Total cholesterol\n      )\n\n    # Correlation matrix (pairwise complete obs ignores NAs)\n    corr_matrix <- cor(num_vars, use = \"pairwise.complete.obs\")\n    ```\n\n```{r}\n#| echo: false\n# Correlation heatmap\ncorrplot(corr_matrix,\n         method = \"color\",\n         type   = \"upper\",\n         tl.col = \"black\",\n         tl.cex = 0.9,\n         title  = \"Correlation Between Key Health Variables\",\n         mar    = c(0,0,2,0))\n```\n\nThe correlation heatmap shows that BMI and waist circumference are strongly correlated, while blood pressure and cholesterol show moderate positive relationships with other metabolic indicators.\n\n#### VI. Answering Research Questions\n\n**(i)** Our first research question explores how BMI influences the risk of diabetes among adults. We first created a binary variable which indicates if a person has diabetes or not (based on the DIQ010 variable), where 1 = Diabetes and 0 = No Diabetes. We also dropped any values which were not available or missing. We then fit a logistic regression model with the diabetes as the response variable and the BMI as the predictor. The aim of this model is to predict if the chances of diabetes increases with BMI.\n\nWe also grouped the BMI values into 5 standard categories\\[3\\], **Underweight** (less than 18.5), **Normal** (between 18.5 and less than 25), **Overweight** (25 to less than 30), **Obese** ( 30 or greater) and **Severe Obese** (40 or greater).\n\nFor each BMI group we calculated the percentage of people with diabetes. We used a bar plot to visualize the result.\n\n```{r}\n#| echo: false\nlibrary(tidyr)\nnhanes_rq1 <- nhanes %>%\n  mutate(\n    diabetes = ifelse(DIQ010 == 1, 1, 0)\n  ) %>%\n  drop_na(BMXBMI, diabetes)\n\n# Logistic regression model\nmodel_rq1 <- glm(diabetes ~ BMXBMI, data = nhanes_rq1, family = \"binomial\")\nsummary(model_rq1)\n\nprev_bmi <- nhanes_rq1 %>%\n  mutate(bmi_group = cut(\n    BMXBMI,\n    breaks = c(-Inf, 18.5, 25, 30, 35, Inf),\n    labels = c(\"Underweight\", \"Normal\", \"Overweight\", \"Obese\", \"Severe Obese\")\n  )) %>%\n  group_by(bmi_group) %>%\n  summarize(\n    total = n(),\n    diabetes_cases = sum(diabetes == 1),\n    prevalence = diabetes_cases / total\n  )\n\nggplot(prev_bmi, aes(x = bmi_group, y = prevalence)) +\n  geom_col(fill = \"steelblue\") +\n  geom_text(aes(label = round(prevalence, 3)), vjust = -0.4) +\n  labs(title = \"Diabetes Prevalence by BMI Category\",\n       x = \"BMI Category\",\n       y = \"Prevalence of Diabetes\") + theme_minimal()\n```\n\nThe logistic regression results show that BMI is a statistically significant predictor of diabetes (p \\< 2e-16). The positive coefficient (0.058) indicates that as BMI increases, the chances of having diabetes also increase. The barplot also helps us easily visualize the increase in the prevalence of diabetes as the BMI increases, with the normal category having a 0.07% chance of diabetes and the severe obese category having a 0.22% chance of diabetes.\n\n**(ii)** In our second research question, we explore and try to answer if we can predict diabetes using health risk factors such as BMI, HbA1c, blood pressure, cholesterol, and smoking status.\n\nWe selected another subset of variables to fit a logistic regression model. We then generated predicted probabilities and classified individuals as diabetic or non-diabetic, which allowed us to compare predicted versus actual outcomes through a confusion matrix. This model lets us to assess how each risk factor influences the likelihood of developing diabetes while accounting for the others.\n\nWe then created a classification tree with the same predictors to see how the variables split the data and which factors were most relevant for prediction. This tree is a simple graphical representation of the decision criteria that distinguish diabetics from non-diabetics. Together, these steps allows us to evaluate both statistical significance and prediction accuracy for diabetes risk.\n\n```{r}\n#| echo: false\nnhanes_rq2 <- nhanes %>%\n  select(\n    SEQN,\n    RIDAGEYR,        # Age\n    RIAGENDR,        # Gender\n    RIDRETH3,        # Race/Ethnicity\n    INDFMPIR,        # Income ratio\n    DMDEDUC2,        # Education\n    BMXBMI,          # BMI\n    BMXWT,           # Weight\n    BMXHT,           # Height\n    BMXWAIST,        # Waist circumference\n    SBP_mean,        # Systolic BP\n    DBP_mean,        # Diastolic BP\n    LBXGH,           # HbA1c\n    LBXTC,           # Total cholesterol\n    diabetes,        # Diabetes (0/1)\n    smoker_ever      # Smoking (0/1)\n  ) %>%\n  drop_na(RIDAGEYR, BMXBMI, LBXGH, LBXTC, SBP_mean, DBP_mean)\nlog_r2 <- nhanes_rq2 %>%\n  drop_na(\n    diabetes,\n    BMXBMI, SBP_mean, DBP_mean,\n    LBXGH, LBXTC, smoker_ever\n  )\n\nmodel_rq2 <- glm(\n  diabetes ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = log_r2,\n  family = \"binomial\"\n)\nsummary(model_rq2)\n\npred_prob <- predict(model_rq2, type = \"response\")\npred_class <- ifelse(pred_prob > 0.5, 1, 0)\n\ntable(Predicted = pred_class, Actual = log_r2$diabetes)\n\nlibrary(tree)\n\ntree_rq2 <- tree(factor(diabetes) ~ BMXBMI + SBP_mean + DBP_mean +\n                   LBXGH + LBXTC + smoker_ever,\n                 data = log_r2)\n\nplot(tree_rq2)\ntext(tree_rq2, pretty = 0)\n```\n\nThe logistic regression results demonstrate that HbA1c (LBXGH) is the most powerful predictor of diabetes, with a large and highly significant coefficient (2.1755). BMI, systolic blood pressure, and cholesterol are all significant predictors of diabetes, but smoking status is not. The confusion matrix demonstrates that the model performs well overall: it properly categorised 4,247 non-diabetic individuals and 412 diabetic individuals, with just 271 false negatives and 56 false positives. With an accuracy of 93%. This suggests that the model can reasonably differentiate between diabetic and non-diabetic patients.\n\nThe tree also demonstrates that HbA1c is the main variable which splits the individuals into diabetic or non diabetic groups. If the A1c (blood glucose/sugar) value is less than 5.7, it is normal, but if it is greater than 6.5, the person is diabetic \\[4\\].\n\n**(iii)** In our third and final research question, we try to find if we can properly classify individuals into high vs low metabolic risk groups. To answer this question we created a new variable \"high_risk\". Indivizuals were going to be labeled high risk if they met the clinical points. That is, if their :\n\n-   AC1 levels (blood glucose levels, LBXGH) were 5.7 or higher \\[4\\];\n\n-   BMI levels (BMXMBI levels) were 30 or higher \\[3\\];\n\n-   Systolic blood pressure (SBP_mean) were 130 or higher \\[5\\];\n\n-   Total Cholesterol levels ( LBXTC) were 200 or higher \\[6\\].\n\n    We then chose the relevant predictors and used a logistic regression model to determine what factors predicted a high metabolic risk strongly. We also built a confusion matrix to assess how effectively the model predicted high- and low-risk individuals. Finally, we trained a random forest model to compare results and see whether a more flexible model increases prediction accuracy.\n\n```{r}\n#| echo: false\nnhanes_rq3 <- nhanes %>%\n  mutate(\n    high_risk = ifelse(\n      LBXGH >= 5.7 | BMXBMI >= 30 | SBP_mean >= 130 | LBXTC >= 200,\n      1, 0\n    )\n  ) %>%\n  select(BMXBMI, SBP_mean, DBP_mean, LBXGH, LBXTC, smoker_ever, high_risk) %>%\n  drop_na()\n\nmodel_rq3 <- glm(\n  high_risk ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = nhanes_rq3,\n  family = \"binomial\"\n)\n\nsummary(model_rq3)\nprob3 <- predict(model_rq3, type = \"response\")\npred3 <- ifelse(prob3 > 0.5, 1, 0)\n\ntable(Predicted = pred3, Actual = nhanes_rq3$high_risk)\n\nlibrary(randomForest)\n\nrf_rq3 <- randomForest(\n  factor(high_risk) ~ BMXBMI + SBP_mean + DBP_mean + LBXGH + LBXTC + smoker_ever,\n  data = nhanes_rq3,\n  ntree = 200,\n  mtry = 3\n)\n\nrf_rq3\n```\n\nThe logistic regression results indicates that all clinical factors are strong predictors of metabolic risk, particularly HbA1c, cholesterol, BMI and systolic blood pressure. All predictors had significant p-values(p\\<0.001), suggesting they do help identify individuals at high metabolic risk.\n\nThe confusion matrix also shows that the logistic model performs effectively, correctly identifying 696 low-risk and 3991 high-risk people, with only small misclassification in the low-risk group. This indicates that the model is very good at detecting high-risk individuals but less accurate for low-risk ones. The random forest model also performs extraordinarily well, with an error rate of 0%, indicating that it correctly identified all individuals in this sample.\n\n## Results\n\nAfter answering all the three research questions, our analysis showed that health factors such as BMI, HbA1c, blood pressure and cholesterol levels are very strong predictors of diabetes and overall metabolic risk. We were able to prove that BMI played a role in the prevalence of diabetes. Using a multivariable logistic model for diabetes prediction helps us analyse that HbA1c is the most influential predictor. The model not only performed well but also had an accuracy of 93%. The high and low risk classification model also showed a great performance as it achieved perfect accuracy.\n\n*NOTE: The random forest model has a 0% error rate since the high-risk variable was created with the same variables as the model (HbA1c, BMI, blood pressure, and cholesterol). Because these clinical cutoffs establish risk status, the random forest could exactly reproduce this rule. This outcome shows overfitting, rather than real prediction performance on unknown data.*\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"results.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.32","theme":"sandstone","title":"Methodology and Results"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}